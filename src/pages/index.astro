---
import { getCollection } from "astro:content";

import PostCard from "@/components/PostCard.astro";
import ProjectCard from "@/components/ProjectCard.astro";
import SocialLinks from "@/components/SocialLinks.astro";
import Layout from "@/layouts/Layout.astro";

import projects from "@/data/projects";

const posts = (await getCollection("posts")).sort(
	(first, second) => second.data.publishedAt.getTime() - first.data.publishedAt.getTime(),
);
---

<Layout>
  <div class="hero">
    <h1 class="hero-name"><strong>Stefan</strong> Legg</h1>
    <div class="hero-role">Software Engineer</div>
    <div class="hero-sub">15+ years building for the web &mdash; currently at Shopify</div>
  </div>

  <div class="section" style="animation-delay: 0.5s;">
    <h2 class="section-label">About</h2>
    <div class="section-text">
      I've been building for the web for <strong>over 15 years</strong> â€” everything from scrappy experiments to tools used by <strong>millions around the world</strong>. These days, I'm focused on React, TypeScript, and making commerce better for everyone.
    </div>
  </div>

  <div class="section" style="animation-delay: 0.6s;">
    <h2 class="section-label">Work</h2>
    <div class="project-list">
      {projects.map((project, index) => (
        <ProjectCard {...project} index={index} />
      ))}
    </div>
  </div>

  {posts.length > 0 && (
    <div class="section" style="animation-delay: 0.75s;">
      <h2 class="section-label">Writing</h2>
      {posts.slice(0, 1).map((post) => (
        <PostCard
          publishedAt={post.data.publishedAt}
          title={post.data.title}
          description={post.data.description}
          slug={post.slug}
          contentType="posts"
        />
      ))}
    </div>
  )}

  <div class="section" style="animation-delay: 0.85s;">
    <h2 class="section-label">Connect</h2>
    <SocialLinks />
  </div>

  <div class="footer">
    <span>&copy; 2026 Stefan Legg</span>
    <span id="footer-clock"></span>
  </div>
</Layout>

<script>
  function initFooterClock() {
    const el = document.getElementById('footer-clock');
    if (!el) return;
    function u() {
      const d = new Date();
      el!.textContent =
        String(d.getUTCHours()).padStart(2, '0') + ':' +
        String(d.getUTCMinutes()).padStart(2, '0') + ':' +
        String(d.getUTCSeconds()).padStart(2, '0') + ' UTC';
    }
    u();
    const interval = setInterval(u, 1000);
    document.addEventListener('astro:before-swap', function cleanup() {
      clearInterval(interval);
      document.removeEventListener('astro:before-swap', cleanup);
    }, { once: true });
  }
  document.addEventListener('astro:page-load', initFooterClock);
</script>

<style>
  .hero {
    padding: 56px 0 48px;
    opacity: 0; animation: fade-up 1s ease 0.4s forwards;
  }
  .hero-name {
    font-family: var(--font-body);
    font-size: clamp(48px, 12vw, 76px);
    font-weight: 200; line-height: 1.0;
    color: var(--text); letter-spacing: -0.5px;
    text-shadow: 0 0 40px rgba(160, 128, 196, 0.18);
  }
  .hero-name :global(strong) { font-weight: 600; }
  .hero-role {
    font-family: var(--font-mono); font-size: 16px; font-weight: 400;
    letter-spacing: 4px; text-transform: uppercase;
    color: var(--accent); margin-top: 18px;
    text-shadow: 0 0 12px var(--accent-glow);
  }
  .hero-sub {
    font-family: var(--font-mono); font-size: 14px;
    color: var(--text-label); margin-top: 10px;
    letter-spacing: 1px;
  }

  .section {
    padding: 48px 0;
    opacity: 0; animation: fade-up 0.8s ease forwards;
  }
  .section-label {
    font-family: var(--font-mono); font-size: 14px; font-weight: 500;
    letter-spacing: 4px; text-transform: uppercase;
    color: var(--text-label); margin-bottom: 24px;
    display: flex; align-items: center; gap: 12px;
  }
  .section-label::after {
    content: ''; flex: 1; height: 1px; background: var(--text-rule);
  }
  .section-text {
    font-size: 24px; font-weight: 300; line-height: 1.85;
    color: var(--text-body);
  }
  .section-text :global(strong) { color: var(--text-strong); font-weight: 500; }

  .project-list { display: flex; flex-direction: column; }

  .footer {
    padding: 28px 0 40px;
    display: flex; justify-content: space-between;
    font-family: var(--font-mono); font-size: 13px; font-weight: 400;
    letter-spacing: 3px; text-transform: uppercase; color: var(--text-muted);
    opacity: 0; animation: fade-up 0.5s ease 1.0s forwards;
  }

  @media (max-width: 600px) {
    .hero { padding: 40px 0 36px; }
    .hero-name { font-size: 36px; }
    .footer { flex-direction: column; gap: 6px; text-align: center; }
  }
</style>
